# Issue Templates for Guest Shopping Flow Milestone

以下の Issue を GitHub に作成してください。

---

## Issue #1: ゲストユーザーセッション管理システムの実装

**Labels:** `enhancement`, `backend`, `priority: critical`, `sprint-1`

### 📝 概要

ログイン前のユーザーの行動（店舗選択、カート操作）を追跡・保持するためのセッション管理システムを構築します。

### 🎯 目的

- ゲストユーザーの行動を 24 時間保持
- ログイン後にゲストデータをユーザーアカウントにマージ
- セキュアなセッション管理

### ✅ タスク

- [ ] `guest_sessions` テーブルのマイグレーション作成
- [ ] `guest_cart_items` テーブルのマイグレーション作成
- [ ] セッション生成 API 実装 (`POST /api/guest/session`)
- [ ] セッション取得 API 実装 (`GET /api/guest/session/{session_id}`)
- [ ] HTTPOnly Cookie でセッション ID 保存
- [ ] セッションクリーンアップタスク実装（24 時間後に自動削除）
- [ ] セキュリティレビュー（CSRF, XSS 対策）

### 📋 受け入れ基準

- [ ] セッション ID が暗号学的に安全に生成される（uuid4 + secrets）
- [ ] 24 時間後に自動的にセッションが無効化される
- [ ] セッション ID が HTTPOnly Cookie で安全に保存される
- [ ] 同一ブラウザで複数タブを開いても同じセッションを共有
- [ ] 単体テスト・統合テストが書かれている

### 📊 見積もり

**13 Story Points**

---

## Issue #2: 店舗検索・選択 UI の実装（ゲスト対応）

**Labels:** `enhancement`, `frontend`, `UI/UX`, `priority: critical`, `sprint-1`

### 📝 概要

添付画像のような、ログイン不要で利用できる店舗検索・選択画面を実装します。

### 🎯 目的

- お客様が最初に「店舗を選ぶ」体験を提供
- 検索とフィルタリングで目的の店舗を見つけやすく

### ✅ タスク

- [ ] 店舗一覧ページ作成 (`/stores`)
- [ ] 店舗検索機能実装（テキスト検索、地域フィルター）
- [ ] 店舗カード UI 実装
- [ ] 店舗詳細ページ作成 (`/stores/{store_id}`)
- [ ] 店舗選択処理実装（セッションに保存）
- [ ] モバイルレスポンシブ対応
- [ ] アクセシビリティ対応（ARIA 属性、キーボード操作）

### 📋 受け入れ基準

- [ ] ログインなしで全店舗を閲覧・検索できる
- [ ] 検索が高速（< 200ms）
- [ ] 店舗選択がセッションに保存される
- [ ] モバイルでタッチ操作が快適
- [ ] 営業中/休業中が視覚的に判別できる

### 🔗 依存関係

- Issue #1（ゲストセッション管理）

### 📊 見積もり

**8 Story Points**

---

## Issue #3: ゲストカート API・UI の実装

**Labels:** `enhancement`, `backend`, `frontend`, `priority: critical`, `sprint-2`

### 📝 概要

ログイン前のユーザーがメニューをカートに追加・編集できる機能を実装します。

### 🎯 目的

- ログインなしでカート機能を利用可能に
- カート内容の永続化（24 時間）
- 直感的なカート操作 UI

### ✅ タスク

**Backend:**

- [ ] カート追加 API (`POST /api/guest/cart/add`)
- [ ] カート取得 API (`GET /api/guest/cart`)
- [ ] カートアイテム更新 API (`PUT /api/guest/cart/item/{item_id}`)
- [ ] カートアイテム削除 API (`DELETE /api/guest/cart/item/{item_id}`)
- [ ] 在庫チェック・バリデーション実装

**Frontend:**

- [ ] カートアイコン・バッジ実装（ヘッダー固定）
- [ ] 「カートに追加」ボタンとアニメーション
- [ ] カートページ UI 実装 (`/cart`)
- [ ] 数量変更機能（+/-ボタン）
- [ ] リアルタイム合計金額計算
- [ ] モバイル最適化

### 📋 受け入れ基準

- [ ] ログインなしでカートに商品を追加できる
- [ ] カート内容がページ遷移しても保持される
- [ ] カートアイコンにアイテム数バッジが表示される
- [ ] 在庫切れメニューは追加できない
- [ ] エラーハンドリングが適切（トースト通知）
- [ ] E2E テストが書かれている

### 🔗 依存関係

- Issue #1（ゲストセッション管理）
- Issue #2（店舗選択）

### 📊 見積もり

**13 Story Points**

---

## Issue #4: メニュー一覧ページの改善（ゲスト体験向け）

**Labels:** `enhancement`, `frontend`, `UI/UX`, `priority: high`, `sprint-2`

### 📝 概要

ゲストユーザーがストレスなくメニューを閲覧・選択できる UI/UX を実装します。

### ✅ タスク

- [ ] 選択中の店舗バナー表示
- [ ] カテゴリフィルター実装
- [ ] 商品カードデザイン最適化
- [ ] 画像遅延読み込み実装
- [ ] クイックビューモーダル実装
- [ ] ページネーション or 無限スクロール

### 📋 受け入れ基準

- [ ] ページ読み込みが 2 秒以内
- [ ] 画像の遅延読み込みが実装されている
- [ ] カテゴリ切り替えがスムーズ
- [ ] モバイルで片手操作しやすいレイアウト

### 🔗 依存関係

- Issue #2（店舗選択）
- Issue #3（ゲストカート）

### 📊 見積もり

**5 Story Points**

---

## Issue #5: ゲストチェックアウト → 認証フローの実装

**Labels:** `enhancement`, `backend`, `frontend`, `priority: critical`, `sprint-3`

### 📝 概要

カート確認後、最適なタイミングで認証を求め、スムーズに注文完了まで導きます。

### 🎯 目的

- 購入意欲が高まったタイミングで認証を要求
- ゲストカート → ユーザーカートへのシームレスな移行

### ✅ タスク

**Backend:**

- [ ] チェックアウト開始 API (`POST /api/checkout/initiate`)
- [ ] ゲストカート → ユーザーカート移行処理
- [ ] 在庫・営業時間バリデーション
- [ ] セッション変換済みフラグ管理

**Frontend:**

- [ ] 認証選択画面実装 (`/auth/choice`)
- [ ] ログイン後のリダイレクト処理
- [ ] カート内容のサマリー表示
- [ ] エラーハンドリング（在庫切れ等）

### 📋 受け入れ基準

- [ ] カート → 認証 → 確認の流れがシームレス
- [ ] ゲストカートがログイン後に正しくマージされる
- [ ] 認証後、選択していた店舗・商品が保持される
- [ ] 他人のカートを覗けない（セキュリティ）
- [ ] E2E テストが書かれている

### 🔗 依存関係

- Issue #3（ゲストカート）

### 📊 見積もり

**21 Story Points**

---

## Issue #6: 新規登録フォームの簡素化

**Labels:** `enhancement`, `frontend`, `UI/UX`, `priority: high`, `sprint-3`

### 📝 概要

チェックアウトフロー内での新規登録を最小限の入力項目で完了できるようにします。

### ✅ タスク

- [ ] 必須項目の最小化（メール、パスワード、氏名、電話のみ）
- [ ] リアルタイムバリデーション実装
- [ ] パスワード強度メーター追加
- [ ] わかりやすいエラーメッセージ
- [ ] 登録後すぐにチェックアウトに戻る処理
- [ ] （オプション）ソーシャルログイン（Google, LINE）

### 📋 受け入れ基準

- [ ] 登録完了まで 1 分以内
- [ ] モバイルで入力しやすいフォーム
- [ ] 登録後すぐにチェックアウトに戻れる
- [ ] アクセシビリティ対応

### 🔗 依存関係

- Issue #5（認証フロー）

### 📊 見積もり

**5 Story Points**

---

## Issue #7: 注文確認ページの実装

**Labels:** `enhancement`, `frontend`, `priority: high`, `sprint-3`

### 📝 概要

ログイン後、スムーズに注文を確定できる確認画面を実装します。

### ✅ タスク

- [ ] お客様情報セクション（自動入力済み）
- [ ] 受け取り情報セクション（店舗、日時選択）
- [ ] 注文内容セクション（カート内容表示）
- [ ] 支払い方法セクション
- [ ] 合計金額セクション
- [ ] 「注文を確定」ボタン実装
- [ ] 営業時間内の受け取り時間のみ選択可能
- [ ] 確認画面のデザイン最適化

### 📋 受け入れ基準

- [ ] ユーザー情報が自動入力される
- [ ] 受け取り日時を選択できる（営業時間内のみ）
- [ ] 注文内容を最終確認できる
- [ ] 確定ボタンがわかりやすく配置されている
- [ ] モバイル最適化

### 🔗 依存関係

- Issue #5（認証フロー）

### 📊 見積もり

**8 Story Points**

---

## Issue #8: ゲストユーザー行動分析ダッシュボード

**Labels:** `enhancement`, `backend`, `analytics`, `priority: medium`, `sprint-4`

### 📝 概要

ゲストユーザーの行動を可視化し、離脱ポイントを特定して継続的に改善します。

### ✅ タスク

- [ ] ファネル分析 API 実装
- [ ] カート放棄率 API 実装
- [ ] コンバージョン時間分析 API 実装
- [ ] ダッシュボード UI 実装
- [ ] グラフ可視化（Chart.js or D3.js）
- [ ] CSV エクスポート機能
- [ ] リアルタイム更新機能

### 📊 見積もり

**8 Story Points**

---

## Issue #9: パフォーマンス最適化

**Labels:** `performance`, `optimization`, `priority: medium`, `sprint-4`

### 📝 概要

ゲストユーザー体験を高速化し、離脱率をさらに削減します。

### ✅ タスク

**Frontend:**

- [ ] 画像最適化（WebP 変換、遅延読み込み）
- [ ] JavaScript バンドルサイズ削減
- [ ] Critical CSS inline 化
- [ ] Service Worker 導入（PWA 化）

**Backend:**

- [ ] データベースクエリ最適化
- [ ] Redis キャッシング（メニュー一覧、店舗情報）
- [ ] API レスポンスタイム改善（< 200ms）

**Infrastructure:**

- [ ] CDN 導入（静的ファイル配信）
- [ ] データベース接続プール最適化

### 📋 目標

- [ ] ページ読み込み時間: < 2 秒（3G 回線）
- [ ] Time to Interactive: < 3 秒
- [ ] Lighthouse Score: 90+

### 📊 見積もり

**5 Story Points**

---

## Issue #10: A/B テストフレームワークの導入

**Labels:** `enhancement`, `analytics`, `priority: medium`, `sprint-5`

### 📝 概要

UI の改善案をデータドリブンで検証できる仕組みを構築します。

### ✅ タスク

- [ ] A/B テストフレームワーク実装
- [ ] ユーザー振り分けロジック実装
- [ ] イベントトラッキング実装
- [ ] 結果分析ダッシュボード

### 📊 見積もり

**8 Story Points**

---

## 📊 全体サマリー

| Issue                   | 優先度      | Sprint   | Story Points |
| ----------------------- | ----------- | -------- | ------------ |
| #1 ゲストセッション管理 | 🔴 Critical | Sprint 1 | 13           |
| #2 店舗選択 UI          | 🔴 Critical | Sprint 1 | 8            |
| #3 ゲストカート         | 🔴 Critical | Sprint 2 | 13           |
| #4 メニュー一覧改善     | 🟡 High     | Sprint 2 | 5            |
| #5 認証フロー           | 🔴 Critical | Sprint 3 | 21           |
| #6 新規登録簡素化       | 🟡 High     | Sprint 3 | 5            |
| #7 注文確認ページ       | 🟡 High     | Sprint 3 | 8            |
| #8 分析ダッシュボード   | 🟢 Medium   | Sprint 4 | 8            |
| #9 パフォーマンス最適化 | 🟢 Medium   | Sprint 4 | 5            |
| #10 A/B テスト          | 🟢 Medium   | Sprint 5 | 8            |

**合計:** 94 Story Points（約 10 週間の開発期間）

---

## 🚀 実装順序

1. **Sprint 1（Week 1-2）**: Issue #1, #2 - 基盤構築
2. **Sprint 2（Week 3-4）**: Issue #3, #4 - カート機能
3. **Sprint 3（Week 5-6）**: Issue #5, #6, #7 - チェックアウトフロー
4. **Sprint 4（Week 7-8）**: Issue #8, #9 - 分析・最適化
5. **Sprint 5（Week 9-10）**: Issue #10 - A/B テスト、追加機能

---

これらの Issue を GitHub に作成し、Milestone に紐付けて管理してください！
