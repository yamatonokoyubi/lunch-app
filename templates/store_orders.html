<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注文管理 - 弁当注文管理システム</title>
    <link rel="stylesheet" href="/static/css/store_common.css">
    <link rel="stylesheet" href="/static/css/store_orders.css">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
</head>
<body>
    <div class="container">
        {% set active_page = 'orders' %}
        {% include 'includes/store_header.html' %}

        <!-- メインコンテンツ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- ページヘッダー -->
                <section class="store-orders-header">
                    <div class="store-orders-header-content">
                        <div>
                            <h2>📦 注文管理</h2>
                            <p>リアルタイムな注文状況の把握</p>
                        </div>
                        <div class="header-stats">
                            <div class="header-badges">
                                <span class="badge badge-info">全: <span id="totalOrdersCount">0</span>件</span>
                                <span class="badge badge-warning">注文中: <span id="pendingOrdersCount">0</span>件</span>
                                <span class="badge badge-success">準備完了: <span id="readyCount">0</span>件</span>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-secondary sound-toggle" id="soundToggleBtn" title="通知音のON/OFF">
                                    🔔 通知音: ON
                                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                                </button>
                                <button class="btn btn-secondary" id="refreshBtn" title="最新の状態に更新">
                                    🔄 更新
                                </button>
                                <div class="auto-refresh-status" id="autoRefreshStatus">
                                    <span class="status-text" id="autoRefreshText">自動更新: 停止中</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- フィルターセクション -->
                <div class="filter-section">
                    <!-- 検索バーを最優先で配置 -->
                    <div class="filter-group filter-search-primary">
                        <label for="searchInput">注文検索:</label>
                        <input type="text" id="searchInput" class="form-control search-input" 
                               placeholder="注文番号、顧客名、メニュー名で検索...">
                    </div>

                    <!-- ステータスフィルター -->
                    <div class="filter-group">
                        <label>ステータス:</label>
                        <div class="status-checkboxes">
                            <label><input type="checkbox" class="status-checkbox" value="pending" checked> 注文受付</label>
                            <label><input type="checkbox" class="status-checkbox" value="confirmed" checked> 注文確認済み</label>
                            <label><input type="checkbox" class="status-checkbox" value="preparing" checked> 調理中</label>
                            <label><input type="checkbox" class="status-checkbox" value="ready" checked> 準備完了</label>
                            <label><input type="checkbox" class="status-checkbox" value="completed"> 受け渡し完了</label>
                            <label><input type="checkbox" class="status-checkbox" value="cancelled"> キャンセル</label>
                        </div>
                    </div>

                    <!-- 日付フィルター -->
                    <div class="filter-group">
                        <label for="startDate">開始日:</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>

                    <div class="filter-group">
                        <label for="endDate">終了日:</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>

                    <!-- 並び順 -->
                    <div class="filter-group">
                        <label for="sortOrder">並び順:</label>
                        <select id="sortOrder" class="form-control">
                            <option value="newest">新しい順</option>
                            <option value="oldest">古い順</option>
                            <option value="pickup_time">受け取り時間順</option>
                        </select>
                    </div>

                    <!-- フィルターボタン -->
                    <div class="filter-group">
                        <button id="clearSearchBtn" class="btn btn-outline-primary" style="display: none;">検索クリア</button>
                        <button id="clearDateBtn" class="btn btn-outline-primary" style="display: none;">日付クリア</button>
                        <button id="resetFiltersBtn" class="btn btn-outline-secondary">フィルターリセット</button>
                    </div>
                </div>

                <!-- 注文リスト -->
                <div class="orders-list">
                    <!-- ローディング -->
                    <div id="loadingContainer" class="loading-indicator" style="display: none;">
                        <div class="spinner"></div>
                        <p>注文データを読み込み中...</p>
                    </div>

                    <!-- エラー表示 -->
                    <div id="errorContainer" class="error-message" style="display: none;">
                        <p id="errorMessage">注文データの読み込みに失敗しました</p>
                        <button onclick="orderManager.loadOrders()" class="btn btn-primary">再試行</button>
                    </div>

                    <!-- 空状態 -->
                    <div id="emptyState" class="empty-message" style="display: none;">
                        <p>表示する注文がありません</p>
                    </div>

                    <!-- 注文グリッド -->
                    <div id="ordersGrid" class="orders-grid">
                        <!-- 注文カードがここに動的に表示されます -->
                    </div>
                </div>

                <!-- ページネーション -->
                <div class="pagination-container" id="paginationContainer" style="display: none;">
                    <nav class="pagination">
                        <button class="btn btn-outline-primary" id="prevPageBtn" disabled>前のページ</button>
                        <span class="page-info" id="pageInfo">1 / 1</span>
                        <button class="btn btn-outline-primary" id="nextPageBtn" disabled>次のページ</button>
                    </nav>
                </div>

                <!-- 検索結果情報 -->
                <div id="searchResultsInfo" class="search-results-info" style="display: none;">
                    <div class="results-count">検索結果: 0件</div>
                    <div class="active-filters"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- トースト通知コンテナ -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- 注文詳細モーダル -->
    <div id="orderDetailModal" class="modal" style="display: none;">
        <div id="modalOverlay" class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalOrderNumber">注文詳細</h3>
                <button type="button" id="modalCloseBtn" class="modal-close" aria-label="閉じる">&times;</button>
            </div>
            <div id="orderDetailBody" class="modal-body">
                <!-- 注文詳細がここに表示されます -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="modalCancelBtn">閉じる</button>
                <button type="button" class="btn btn-primary" id="modalActionBtn">アクション</button>
            </div>
        </div>
    </div>

    <!-- 共通JavaScript -->
    <script src="/static/js/common.js?v=4"></script>
    <!-- JavaScript -->
    <script src="/static/js/store_header.js?v=4"></script>
    <script src="/static/js/store_orders.js?v=3"></script>
</body>
</html>